# This "input" configures a global authorization rule to enable public access to
# all models in this schema. Learn more about authorization rules here: https://docs.amplify.aws/cli/graphql/authorization-rules
input AMPLIFY {
  globalAuthRule: AuthRule = { allow: public }
} # FOR TESTING ONLY!
# This "input" configures a global authorization rule to enable public access to
# all models in this schema. Learn more about authorization rules here: https://docs.amplify.aws/cli/graphql/authorization-rules
input AMPLIFY {
  globalAuthRule: AuthRule = { allow: public }
} # FOR TESTING ONLY!
type Address @aws_cognito_user_pools {
  name: String!
  contact: String!
  street: String!
  city: String!
  state: String!
  country: String!
  zip: String!
}

input AddressInput {
  name: String!
  contact: String!
  street: String!
  city: String!
  state: String!
  country: String!
  zip: String!
}

type Cart @aws_cognito_user_pools {
  userId: ID!
  totalPrice: Float!
  totalItems: Int!
  items: [CartItem!]!
  updatedAt: AWSDateTime
}

type CartItem @aws_cognito_user_pools {
  productId: ID!
  name: String!
  thumbnail: String
  brand: String
  category: String
  finalPrice: Float
  discountPercentage: Float
  quantity: Int!
}

input CartItemInput {
  productId: ID!
  name: String!
  thumbnail: String
  brand: String
  category: String
  finalPrice: Float
  quantity: Int!
}

type Dimensions {
  width: String
  height: String
  depth: String
  weight: String
}

type Order @aws_cognito_user_pools {
  orderId: ID!
  userId: ID!
  products: [CartItem!]!
  total: Float!
  totalProducts: Int!
  address: Address!
  createdAt: AWSDateTime!
  status: String!
}

type Product {
  productId: ID!
  name: String!
  description: String
  price: Float
  finalPrice: Float
  discountPercentage: Float
  stock: Int
  category: String
  sku: String
  thumbnail: String
  brand: String
  images: [String]
  rating: Rating
  dimensions: Dimensions
}

type Rating {
  average: Float
  count: Int
}

type UploadUrl @aws_cognito_user_pools {
  uploadUrl: String!
  fileUrl: String!
}

type UserProfile @aws_cognito_user_pools {
  userId: ID!
  name: String!
  email: String!
  phone: String
  birthdate: String
  age: String
  gender: String
  bio: String
  avatar: String
  height: String
  weight: String
  address: Address
  createdAt: AWSDateTime
  updatedAt: AWSDateTime
}

input UserProfileInput {
  name: String!
  email: String
  phone: String
  birthdate: String
  age: String
  avatar: String
  height: String
  weight: String
  gender: String
  bio: String
  address: AddressInput
}

type ChatMessage @aws_cognito_user_pools {
  userId: ID!
  sender: String!
  message: String!
  createdAt: AWSDateTime!
}

type Mutation @aws_cognito_user_pools {
  addToCart(
    productId: ID!
    name: String!
    thumbnail: String
    brand: String
    category: String
    finalPrice: Float!
    discountPercentage: Float
    quantity: Int!
  ): Cart @aws_cognito_user_pools
  updateCartItem(productId: ID!, quantity: Int!): Cart @aws_cognito_user_pools
  removeCartItem(productId: ID!): Cart @aws_cognito_user_pools
  clearCart: Cart @aws_cognito_user_pools
  placeOrder(
    products: [CartItemInput!]!
    total: Float!
    totalProducts: Int!
    address: AddressInput!
  ): Order @aws_cognito_user_pools
  updateOrderStatus(orderId: ID!, status: String!): Order
    @aws_cognito_user_pools
  saveUserProfile(input: UserProfileInput!): UserProfile @aws_cognito_user_pools
  getAvatarUploadUrl(fileType: String!): UploadUrl @aws_cognito_user_pools
  sendUserMessage(message: String!): ChatMessage @aws_cognito_user_pools
  sendAdminMessage(userId: ID!, message: String!): ChatMessage
    @aws_cognito_user_pools
}

type Query {
  getProducts: [Product]
  getProductsByCategory(category: String!): [Product]
  getCategory: [String]
  getProductById(productId: ID!): Product
  getCart: Cart @aws_cognito_user_pools
  getOrders: [Order] @aws_cognito_user_pools
  getAllOrders: [Order] @aws_cognito_user_pools(cognito_groups: ["ADMIN"])
  getUserProfile: UserProfile @aws_cognito_user_pools
  getChat(userId: ID!): [ChatMessage] @aws_cognito_user_pools
  getAllChats: [ChatMessage] @aws_cognito_user_pools(cognito_groups: ["ADMIN"])
}

type Subscription @aws_cognito_user_pools {
  onCartUpdated(userId: ID!): Cart
    @aws_subscribe(
      mutations: ["addToCart", "updateCartItem", "removeCartItem", "clearCart"]
    )

  onOrderPlaced(userId: ID!): Order @aws_subscribe(mutations: ["placeOrder"])

  onOrderStatusUpdated(orderId: ID!): Order
    @aws_subscribe(mutations: ["updateOrderStatus"])

  onUserProfileUpdated(userId: ID!): UserProfile
    @aws_subscribe(mutations: ["saveUserProfile"])
  onMessageReceived(userId: ID!): ChatMessage
    @aws_subscribe(mutations: ["sendUserMessage", "sendAdminMessage"])
}

schema {
  query: Query
  mutation: Mutation
  subscription: Subscription
}
